---
import BaseLayout from "@/layouts/Base.astro";
import { Tabs, TabItem } from "@astrojs/starlight/components";

// Utility
//import { Octokit } from "octokit"
//import getGitHubURLSplit from "../../../scripts/shared/getGitHubURLSplit";
import getPackageVersions from "../../../aeroSW/tests/shared/getNPMVersions";

const packageVersionsRes = getPackageVersions();
if (packageVersionsRes.isErr())
  throw new Error(`Failed to get the NPM package versions for aero:\n\t${packageVersionsRes.error.stack.split("\n").join("\n\t")}!`);
const packageVersions = packageVersionsRes.value;

/*
const octokit = new Octokit({ auth: import.meta.env.GITHUB_KEY });

const githubURLSplit = getGitHubURLSplit(packageJSON.repository.url);
if (githubURLSplit.isErr())
  throw new Error(`Invalid GitHub URL in the package.json:\n\t${githubURLSplit.error.stack.split("\n").join("\n\t")}!`);
const [owner, repo] = githubURLSplit.value;

const repoJSON = await octokit.request('GET  /repos/{owner}/{repo}', {
		owner,
		repo,
		headers: {
			'X-GitHub-Api-Version': '2022-11-28'
		}
	});
	*/
// TODO: Get all of the commits that have CI builds attached and list them in the corresponding dropdown
---

<BaseLayout title="Welcome to aero">
  <p>{packageJSON.description}</p>
  <label class="input input-bordered flex items-center gap-2">
    <input type="text" class="grow" placeholder="Enter your search query or URL" />
    <svg
      xmlns="http://www.w3.org/2000/svg"
      viewBox="0 0 16 16"
      fill="currentColor"
      class="h-4 w-4 opacity-70">
      <path
        fill-rule="evenodd"
        d="M9.965 11.026a5 5 0 1 1 1.06-1.06l2.755 2.754a.75.75 0 1 1-1.06 1.06l-2.755-2.754ZM10.5 7a3.5 3.5 0 1 1-7 0 3.5 3.5 0 0 1 7 0Z"
        clip-rule="evenodd" />
    </svg>
  </label>
  <table class="table">
    <thead>
      <tr>
        <th><p>Bare Servers</p><br><input type="checkbox" class="toggle toggle-success" checked="checked" /></th>
        <th><p>Wisp Servers</p><br><input type="checkbox" class="toggle toggle-success" checked="checked" /></th>
        <th><p>Proxy Middleware Bundle URLs</p><br><input type="checkbox" class="toggle toggle-success" checked="checked" /></th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td class="bg-base-200">...</td>
        <td class="bg-base-200">...</td>
        <td class="bg-base-200">...</td>
      </tr>
    </tbody>
  </table>
  <br>

  <input type="text" placeholder="Add wisp server" class="input input-bordered input-sm" />
  <button class="btn btn-success btn-sm">Add</button>
  <button class="btn btn-error btn-sm">Remove</button>
  <br>

  <input type="text" placeholder="Add bare server" class="input input-bordered input-sm" />
  <button class="btn btn-success btn-sm">Add</button>
  <button class="btn btn-error btn-sm">Remove</button>
  <br>

  <input type="text" placeholder="Add proxy middleware" class="input input-bordered input-sm" />
  <button class="btn btn-success btn-sm">Add</button>
  <button class="btn btn-error btn-sm">Remove</button>
  <br>

  <h2>Revision Selection</h2>
  <Tabs>
    <TabItem label="NPM">
      <p>Select which NPM version to use of aero</p>
      <select class="select">
        <option selected>{packageVersions[0] + " (latest)"}</option>
        {packageVersions.slice(1).map((item: string) => {
          return <option>{item}</option>
        })};
      </select>
    </TabItem>
    <TabItem label="GitHub">
    <p>Select which GitHub build to use of aero from the commits with successful builds</p>
      <select class="select">
        <option selected>Stable (main)</option>
        <option> Unstable (unstable)</option>
      </select>
      <select class="select">
        <option selected>Stable (latest)</option>
      </select>
    </TabItem>
  </Tabs>
</BaseLayout>